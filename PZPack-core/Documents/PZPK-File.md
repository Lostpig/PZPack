## PZPK文件结构描述


#### Version 1

+ 文件整体
```
┌──────────┐┌────────┬──────────┬────────────┬────────┬────────┐
│ 区块定义 ││ 文件头 │  信息区  │ 索引区偏移 │ 内容区 │ 索引区 │
├──────────┤├────────┼──────────┼────────────┼────────┼────────┤
│长度(byte)││   68   │  8 + n   │ 8          │ n      │ n      │
└──────────┘└────────┴──────────┴────────────┴────────┴────────┘
```

+ 文件头
```
┌──────────┐┌──────────┬────────────┬────────────┐
│ 区块定义 ││ 文件版本 │标识校验Hash│密码校验Hash│
├──────────┤├──────────┼────────────┼────────────┤
│长度(byte)││    4     │     32     │     32     │
└──────────┘└──────────┴────────────┴────────────┘
```

+ 信息区
> 封面图功能未实现留空
```
define: int a = 描述长度, int b = 封面图长度
┌──────────┐┌──────────┬────────┬──────────┬────────┬──────────┐
│ 区块定义 ││ 本区长度 │描述长度│封面图长度│描述数据│封面图数据│
├──────────┤├──────────┼────────┼──────────┼────────┼──────────┤
│长度(byte)││    4     │   4    │    4     │   a    │    b     │
├──────────┤├──────────┼────────┴──────────┴────────┴──────────┤
│ 是否加密 ││    否    │                是                     │
└──────────┘└──────────┴───────────────────────────────────────┘
```

+ 索引区
> 索引区offset取值自【文件整体】部分的【索引区偏移】值
```
define: int a = 文件夹索引长度, int b = 文件索引长度
┌──────────┐┌────────────────┬──────────────┬────────────────┬──────────────┐
│ 区块定义 ││ 文件夹索引长度 │ 文件索引长度 │ 文件夹索引数据 │ 文件索引数据 │
├──────────┤├────────────────┼──────────────┼────────────────┼──────────────┤
│长度(byte)││        4       │       4      │        a       │       b      │
├──────────┤├────────────────┴──────────────┴────────────────┴──────────────┤
│ 是否加密 ││                              是                               │
└──────────┘└───────────────────────────────────────────────────────────────┘

// 单个文件夹索引结构
define: int c = 当前文件夹信息长度 - 8
┌──────────┐┌────────────────────┬──────────┬────────────┬──────────┐
│ 区块定义 ││ 当前文件夹信息长度 │ 文件夹ID │ 父文件夹ID │ 文件夹名 │
├──────────┤├────────────────────┼──────────┼────────────┼──────────┤
│长度(byte)││         4          │     4    │      4     │    c     │
└──────────┘└────────────────────┴──────────┴────────────┴──────────┘

// 单个文件索引结构
define: int d = 当前文件信息长度 - 16
┌──────────┐┌──────────────────┬──────────┬────────────┬──────────┬────────┐
│ 区块定义 ││ 当前文件信息长度 │ 文件夹ID │ 起始Offset │ 文件大小 │ 文件名 │
├──────────┤├──────────────────┼──────────┼────────────┼──────────┼────────┤
│长度(byte)││         4        │     4    │      8     │    4     │    c   │
└──────────┘└──────────────────┴──────────┴────────────┴──────────┴────────┘

```

#### Version 2
+ Version 2 变更
> 单个文件索引的【文件大小】区长度修改为【8】(Int64)，以支持大于2GB的单个文件

#### Version 3
+ Version 3 变更
> 加密部分变更：使用随机向量(IV)，每个加密区前16byte填充IV，并使用该IV加/解密，其余部分不变
